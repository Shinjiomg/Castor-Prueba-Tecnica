---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Registrarse - MusicApp">
  <div class="max-w-md mx-auto">
      <div class="text-center mb-8">
    <h1 class="text-4xl font-bold bg-gradient-to-r from-green-400 to-blue-400 bg-clip-text text-transparent mb-4">
      Crear cuenta
    </h1>
    <p class="text-gray-300 text-lg">
      Únete a MusicApp para guardar tus favoritos
    </p>
  </div>

    <form id="register-form" class="space-y-4">
      <div>
        <label for="username" class="block text-sm font-medium text-gray-300 mb-2">
          Nombre de usuario
        </label>
        <input
          type="text"
          id="username"
          name="username"
          required
          class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400 transition-all duration-200"
        />
      </div>

      <div>
        <label for="email" class="block text-sm font-medium text-gray-300 mb-2">
          Email
        </label>
        <input
          type="email"
          id="email"
          name="email"
          required
          class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400 transition-all duration-200"
        />
      </div>

      <div>
        <label for="password" class="block text-sm font-medium text-gray-300 mb-2">
          Contraseña
        </label>
        <input
          type="password"
          id="password"
          name="password"
          required
          minlength="6"
          class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent text-white placeholder-gray-400 transition-all duration-200"
        />
      </div>

      <div id="error-message" class="text-red-400 text-sm bg-red-900/20 border border-red-800 rounded-lg px-4 py-3 hidden"></div>

      <button
        type="submit"
        class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-medium py-3 px-4 rounded-xl transition-all duration-200 shadow-lg hover:shadow-green-500/25 transform hover:scale-105 cursor-pointer"
      >
        Registrarse
      </button>
    </form>

    <div class="text-center mt-6">
      <p class="text-gray-300">
        ¿Ya tienes cuenta? 
        <a href="/login" class="text-green-400 hover:text-green-300 font-medium transition-colors duration-200">
          Inicia sesión
        </a>
      </p>
    </div>
  </div>
</Layout>

<script>
  const form = document.getElementById('register-form') as HTMLFormElement;
  const errorMessage = document.getElementById('error-message');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(form);
    const data = {
      username: formData.get('username'),
      email: formData.get('email'),
      password: formData.get('password')
    };

    try {
      const response = await fetch('/api/auth/register', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      });

      const result = await response.json();

      if (result.success) {
        // Redirigir al usuario a la página principal
        window.location.href = '/';
      } else {
        if (errorMessage) {
          errorMessage.textContent = result.error;
          errorMessage.classList.remove('hidden');
        }
      }
    } catch (error) {
      if (errorMessage) {
        errorMessage.textContent = 'Error de conexión';
        errorMessage.classList.remove('hidden');
      }
    }
  });
</script> 